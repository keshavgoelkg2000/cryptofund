import {
  e,
  i
} from "./chunk-DH52Z52Z.js";
import {
  getDefaultProvider,
  init_lib as init_lib3
} from "./chunk-O2O3ULHT.js";
import {
  Signer,
  defineReadOnly,
  init_lib13 as init_lib2,
  init_lib4 as init_lib
} from "./chunk-KAA6TFSL.js";
import {
  init_shim
} from "./chunk-6SWLQQ3Q.js";

// node_modules/@paperxyz/embedded-wallet-service-sdk/dist/index.mjs
init_shim();
init_lib3();
init_lib2();
init_lib();
var z = Object.defineProperty;
var q = Object.defineProperties;
var Z = Object.getOwnPropertyDescriptors;
var x = Object.getOwnPropertySymbols;
var $ = Object.prototype.hasOwnProperty;
var B = Object.prototype.propertyIsEnumerable;
var k = (s, e2, t) => e2 in s ? z(s, e2, { enumerable: true, configurable: true, writable: true, value: t }) : s[e2] = t;
var u = (s, e2) => {
  for (var t in e2 || (e2 = {}))
    $.call(e2, t) && k(s, t, e2[t]);
  if (x)
    for (var t of x(e2))
      B.call(e2, t) && k(s, t, e2[t]);
  return s;
};
var y = (s, e2) => q(s, Z(e2));
var i2 = (s, e2, t) => new Promise((r, a) => {
  var o = (l) => {
    try {
      d(t.next(l));
    } catch (p) {
      a(p);
    }
  }, n = (l) => {
    try {
      d(t.throw(l));
    } catch (p) {
      a(p);
    }
  }, d = (l) => l.done ? r(l.value) : Promise.resolve(l.value).then(o, n);
  d((t = t.apply(s, e2)).next());
});
var E = "/sdk/2022-08-12/embedded-wallet";
var de = `${E}/auth/headless-google-login-managed`;
var J = (s) => `paperEwsWalletUserDetails-${s}`;
var L = (s) => `paperEwsWalletUserId-${s}`;
var K = "walletToken";
var I = (s) => `${K}-${s}`;
var Q = "a";
var W = (s, e2) => `${Q}-${s}-${e2}`;
var X = (s) => `${Q}-${s}`;
var w = ((t) => (t.USER_MANAGED = "USER_MANAGED", t.AWS_MANAGED = "AWS_MANAGED", t))(w || {});
var Y = ((n) => (n.PAPER_EMAIL_OTP = "PaperEmailOTP", n.GOOGLE = "Google", n.TWITTER = "Twitter", n.COGNITO = "Cognito", n.AUTH0 = "Auth0", n.CUSTOM_JWT = "CustomJWT", n))(Y || {});
var H = ((t) => (t.LOGGED_OUT = "Logged Out", t.LOGGED_IN_WALLET_INITIALIZED = "Logged In, Wallet Initialized", t))(H || {});
var P = ((a) => (a.LOGGED_OUT = "Logged Out", a.LOGGED_IN_WALLET_UNINITIALIZED = "Logged In, Wallet Uninitialized", a.LOGGED_IN_NEW_DEVICE = "Logged In, New Device", a.LOGGED_IN_WALLET_INITIALIZED = "Logged In, Wallet Initialized", a))(P || {});
var F = /* @__PURE__ */ new Map();
var h = class {
  constructor({ clientId: e2 }) {
    this.isSupported = typeof window != "undefined" && !!window.localStorage, this.clientId = e2;
  }
  getItem(e2) {
    return i2(this, null, function* () {
      var t;
      return this.isSupported ? window.localStorage.getItem(e2) : (t = F.get(e2)) != null ? t : null;
    });
  }
  setItem(e2, t) {
    return i2(this, null, function* () {
      if (this.isSupported)
        return window.localStorage.setItem(e2, t);
      F.set(e2, t);
    });
  }
  removeItem(e2) {
    return i2(this, null, function* () {
      let t = yield this.getItem(e2);
      return this.isSupported && t ? (window.localStorage.removeItem(e2), true) : false;
    });
  }
  saveAuthCookie(e2) {
    return i2(this, null, function* () {
      yield this.setItem(I(this.clientId), e2);
    });
  }
  getAuthCookie() {
    return i2(this, null, function* () {
      return this.getItem(I(this.clientId));
    });
  }
  removeAuthCookie() {
    return i2(this, null, function* () {
      return this.removeItem(I(this.clientId));
    });
  }
  saveDeviceShare(e2, t) {
    return i2(this, null, function* () {
      yield this.saveWalletUserId(t), yield this.setItem(W(this.clientId, t), e2);
    });
  }
  getDeviceShare() {
    return i2(this, null, function* () {
      let e2 = yield this.getWalletUserId();
      return e2 ? this.getItem(W(this.clientId, e2)) : null;
    });
  }
  removeDeviceShare() {
    return i2(this, null, function* () {
      let e2 = yield this.getWalletUserId();
      return e2 ? this.removeItem(W(this.clientId, e2)) : false;
    });
  }
  getWalletUserId() {
    return i2(this, null, function* () {
      return this.getItem(L(this.clientId));
    });
  }
  saveWalletUserId(e2) {
    return i2(this, null, function* () {
      yield this.setItem(L(this.clientId), e2);
    });
  }
  removeWalletUserId() {
    return i2(this, null, function* () {
      return this.removeItem(L(this.clientId));
    });
  }
};
function v(s) {
  return new Promise((e2) => {
    setTimeout(e2, s * 1e3);
  });
}
var ee = { height: "100%", width: "100%", border: "none", backgroundColor: "transparent", colorScheme: "light", position: "fixed", top: "0px", right: "0px", zIndex: "2147483646", display: "none" };
var G = /* @__PURE__ */ new Map();
var f = class {
  constructor({ link: e2, iframeId: t, container: r = document.body, iframeStyles: a, onIframeInitialize: o }) {
    this.POLLING_INTERVAL_SECONDS = 1.4;
    this.POST_LOAD_BUFFER_SECONDS = 1;
    let n = document.getElementById(t), d = new URL(e2), l = "1.2.5";
    if (!l)
      throw new Error("Missing SDK_VERSION env var");
    if (d.searchParams.set("sdkVersion", l), !n || n.src != d.href) {
      if (!n) {
        n = document.createElement("iframe");
        let p = u(u({}, ee), a);
        Object.assign(n.style, p), n.setAttribute("id", t), n.setAttribute("fetchpriority", "high"), r.appendChild(n);
      }
      n.src = d.href, n.setAttribute("data-version", l), n.onload = this.onIframeLoadHandler(n, this.POST_LOAD_BUFFER_SECONDS, o);
    }
    this.iframe = n;
  }
  onIframeLoadedInitVariables() {
    return i2(this, null, function* () {
      return {};
    });
  }
  onIframeLoadHandler(e2, t, r) {
    return () => i2(this, null, function* () {
      yield new Promise((o, n) => i2(this, null, function* () {
        var p;
        let d = new MessageChannel();
        d.port1.onmessage = (m) => {
          let { data: c } = m;
          return d.port1.close(), c.success ? (G.set(e2.src, true), r && r(), o(true)) : n(new Error(c.error));
        }, yield v(t);
        let l = "initIframe";
        (p = e2 == null ? void 0 : e2.contentWindow) == null || p.postMessage({ eventType: l, data: yield this.onIframeLoadedInitVariables() }, `${i()}${E}`, [d.port2]);
      }));
    });
  }
  call(o) {
    return i2(this, arguments, function* ({ procedureName: e2, params: t, showIframe: r = false, injectRecoveryCode: a = { isInjectRecoveryCode: false } }) {
      for (; !G.get(this.iframe.src); )
        yield v(this.POLLING_INTERVAL_SECONDS);
      return r && (this.iframe.style.display = "block", yield v(5e-3)), new Promise((d, l) => {
        var m;
        if (a.isInjectRecoveryCode) {
          let c = (g) => i2(this, null, function* () {
            var U, b;
            if (g.origin !== i() || g.data.type !== "paper_getRecoveryCode" || typeof g.data.userWalletId != "string")
              return;
            let V = yield (U = a.getRecoveryCode) == null ? void 0 : U.call(a, g.data.userWalletId);
            (b = this.iframe.contentWindow) == null || b.postMessage({ type: "paper_getRecoveryCode_response", recoveryCode: V }, i()), window.removeEventListener("message", c);
          });
          window.addEventListener("message", c);
        }
        let p = new MessageChannel();
        p.port1.onmessage = (c) => i2(this, null, function* () {
          let { data: g } = c;
          p.port1.close(), r && (yield v(0.1), this.iframe.style.display = "none"), g.success ? d(g.data) : l(new Error(g.error));
        }), (m = this.iframe.contentWindow) == null || m.postMessage({ eventType: e2, data: t }, `${i()}${E}`, [p.port2]);
      });
    });
  }
  destroy() {
    G.delete(this.iframe.src);
  }
};
var _ = class extends f {
  constructor({ clientId: t, customizationOptions: r }) {
    super({ iframeId: ie, link: re({ clientId: t, path: E, queryParams: r }).href, container: document.body });
    this.clientId = t;
  }
  onIframeLoadedInitVariables() {
    return i2(this, null, function* () {
      let t = new h({ clientId: this.clientId });
      return { authCookie: yield t.getAuthCookie(), deviceShareStored: yield t.getDeviceShare(), walletUserId: yield t.getWalletUserId(), clientId: this.clientId };
    });
  }
};
function re({ clientId: s, path: e2, queryParams: t }) {
  var a;
  let r = new URL(e2, i());
  if (t)
    for (let o of Object.keys(t))
      r.searchParams.set(o, ((a = t[o]) == null ? void 0 : a.toString()) || "");
  return r.searchParams.set("clientId", s), r;
}
var ie = "paper-embedded-wallet-iframe";
var A = class {
  constructor({ querier: e2, preLogin: t, postLogin: r, clientId: a }) {
    this.LoginQuerier = e2, this.preLogin = t, this.postLogin = r, this.clientId = a;
  }
  sendPaperEmailLoginOtp(r) {
    return i2(this, arguments, function* ({ email: e2, recoveryShareManagement: t }) {
      yield this.preLogin();
      let { isNewUser: a, isNewDevice: o, recoveryShareManagement: n } = yield this.LoginQuerier.call({ procedureName: "sendPaperEmailLoginOtp", params: { email: e2, recoveryShareManagement: t } });
      return { isNewUser: a, isNewDevice: o, recoveryShareManagement: n };
    });
  }
};
var C = class extends A {
  constructor() {
    super(...arguments);
    this.closeWindow = ({ isWindowOpenedByFn: t, win: r, closeOpenedWindow: a }) => {
      t ? r == null || r.close() : r && a ? a(r) : r && r.close();
    };
  }
  loginWithPaperModal() {
    return i2(this, null, function* () {
      yield this.preLogin();
      let t = yield this.LoginQuerier.call({ procedureName: "loginWithPaperModal", params: { recoveryShareManagement: "AWS_MANAGED" }, showIframe: true, injectRecoveryCode: { isInjectRecoveryCode: true } });
      return this.postLogin(t);
    });
  }
  getGoogleLoginUrl() {
    return i2(this, null, function* () {
      return yield this.LoginQuerier.call({ procedureName: "getHeadlessGoogleLoginLink", params: void 0 });
    });
  }
  loginWithGoogle(t) {
    return i2(this, null, function* () {
      yield this.preLogin();
      let r = t == null ? void 0 : t.openedWindow, a = false;
      if (r || (r = window.open("", "Login", "width=350, height=500"), a = true), !r)
        throw new Error("Something went wrong opening pop-up");
      yield this.preLogin();
      let { loginLink: o } = yield this.getGoogleLoginUrl();
      r.location.href = o;
      let n = yield new Promise((d, l) => {
        let p = window.setInterval(() => i2(this, null, function* () {
          r && r.closed && (clearInterval(p), window.removeEventListener("message", m), l(new Error("User closed login window")));
        }), 1e3), m = (c) => i2(this, null, function* () {
          if (c.origin === i()) {
            if (typeof c.data != "object") {
              l(new Error("Invalid event data"));
              return;
            }
            switch (c.data.eventType) {
              case "userLoginSuccess": {
                window.removeEventListener("message", m), clearInterval(p), this.closeWindow({ isWindowOpenedByFn: a, win: r, closeOpenedWindow: t == null ? void 0 : t.closeOpenedWindow }), c.data.authResult && d(c.data.authResult);
                break;
              }
              case "userLoginFailed": {
                window.removeEventListener("message", m), clearInterval(p), this.closeWindow({ isWindowOpenedByFn: a, win: r, closeOpenedWindow: t == null ? void 0 : t.closeOpenedWindow }), l(new Error(c.data.error));
                break;
              }
              case "injectDeveloperClientId": {
                r == null || r.postMessage({ eventType: "injectDeveloperClientIdResult", developerClientId: this.clientId }, i());
                break;
              }
            }
          }
        });
        window.addEventListener("message", m);
      });
      return this.postLogin({ storedToken: y(u({}, n.storedToken), { shouldStoreCookieString: true }), walletDetails: y(u({}, n.walletDetails), { isIframeStorageEnabled: false }) });
    });
  }
  loginWithPaperEmailOtp(r) {
    return i2(this, arguments, function* ({ email: t }) {
      yield this.preLogin();
      let a = yield this.LoginQuerier.call({ procedureName: "loginWithPaperModal", params: { email: t, recoveryShareManagement: "AWS_MANAGED" }, showIframe: true, injectRecoveryCode: { isInjectRecoveryCode: true } });
      return this.postLogin(a);
    });
  }
  verifyPaperEmailLoginOtp(a) {
    return i2(this, arguments, function* ({ email: t, otp: r }) {
      let o = yield this.LoginQuerier.call({ procedureName: "verifyPaperEmailLoginOtp", params: { email: t, otp: r, recoveryShareManagement: "AWS_MANAGED" }, injectRecoveryCode: { isInjectRecoveryCode: true } });
      return this.postLogin(o);
    });
  }
};
var D = class extends A {
  loginWithPaperModal(e2) {
    return i2(this, null, function* () {
      yield this.preLogin();
      let t = yield this.LoginQuerier.call({ procedureName: "loginWithPaperModal", params: void 0, showIframe: true, injectRecoveryCode: { isInjectRecoveryCode: true, getRecoveryCode: e2 == null ? void 0 : e2.getRecoveryCode } });
      return this.postLogin(t);
    });
  }
  loginWithGoogle(e2) {
    return i2(this, null, function* () {
      throw new Error("loginWithGoogle is not yet supported in the RecoveryShareManagement.USER_MANAGED flow. Please use RecoveryShareManagement.AWS_MANAGED instead.");
    });
  }
  loginWithPaperEmailOtp(r) {
    return i2(this, arguments, function* ({ email: e2, recoveryCode: t }) {
      yield this.preLogin();
      let a = yield this.LoginQuerier.call({ procedureName: "loginWithPaperModal", params: { email: e2, recoveryCode: t }, showIframe: true, injectRecoveryCode: { isInjectRecoveryCode: true } });
      return this.postLogin(a);
    });
  }
  verifyPaperEmailLoginOtp(a) {
    return i2(this, arguments, function* ({ email: e2, otp: t, recoveryCode: r }) {
      let o = yield this.LoginQuerier.call({ procedureName: "verifyPaperEmailLoginOtp", params: { email: e2, otp: t, recoveryCode: r }, injectRecoveryCode: { isInjectRecoveryCode: true } });
      return this.postLogin(o);
    });
  }
};
var M = class {
  constructor({ clientId: e2, advancedOptions: t, querier: r, onAuthSuccess: a }) {
    var o;
    this.clientId = e2, this.advancedOptions = { recoveryShareManagement: (o = t == null ? void 0 : t.recoveryShareManagement) != null ? o : "AWS_MANAGED" }, this.AuthQuerier = r, this.localStorage = new h({ clientId: e2 }), this.onAuthSuccess = a, this.userManagedLogin = new D({ postLogin: (n) => i2(this, null, function* () {
      return this.postLogin(n);
    }), preLogin: () => i2(this, null, function* () {
      yield this.preLogin();
    }), querier: r, clientId: e2 }), this.awsManagedLogin = new C({ postLogin: (n) => i2(this, null, function* () {
      return this.postLogin(n);
    }), preLogin: () => i2(this, null, function* () {
      yield this.preLogin();
    }), querier: r, clientId: e2 });
  }
  preLogin() {
    return i2(this, null, function* () {
      yield this.logout();
    });
  }
  postLogin(r) {
    return i2(this, arguments, function* ({ storedToken: e2, walletDetails: t }) {
      return e2.shouldStoreCookieString && (yield this.localStorage.saveAuthCookie(e2.cookieString)), yield this.onAuthSuccess({ storedToken: e2, walletDetails: t });
    });
  }
  loginWithJwtAuth(a) {
    return i2(this, arguments, function* ({ token: e2, authProvider: t, recoveryCode: r }) {
      yield this.preLogin();
      let o = yield this.AuthQuerier.call({ procedureName: "loginWithJwtAuthCallback", params: { token: e2, authProvider: t, recoveryCode: r } });
      return this.postLogin(o);
    });
  }
  loginWithPaperModal(e2) {
    return i2(this, null, function* () {
      return yield this.preLogin(), this.advancedOptions.recoveryShareManagement === "AWS_MANAGED" ? this.awsManagedLogin.loginWithPaperModal() : this.userManagedLogin.loginWithPaperModal(e2);
    });
  }
  loginWithPaperEmailOtp(e2) {
    return i2(this, null, function* () {
      return this.advancedOptions.recoveryShareManagement === "AWS_MANAGED" ? this.awsManagedLogin.loginWithPaperEmailOtp({ email: e2.email }) : this.userManagedLogin.loginWithPaperEmailOtp(e2);
    });
  }
  loginWithGoogle(e2) {
    return i2(this, null, function* () {
      return this.advancedOptions.recoveryShareManagement === "AWS_MANAGED" ? this.awsManagedLogin.loginWithGoogle(e2) : this.userManagedLogin.loginWithGoogle();
    });
  }
  sendPaperEmailLoginOtp(t) {
    return i2(this, arguments, function* ({ email: e2 }) {
      return this.advancedOptions.recoveryShareManagement === "AWS_MANAGED" ? this.awsManagedLogin.sendPaperEmailLoginOtp({ email: e2, recoveryShareManagement: "AWS_MANAGED" }) : this.userManagedLogin.sendPaperEmailLoginOtp({ email: e2 });
    });
  }
  verifyPaperEmailLoginOtp(e2) {
    return i2(this, null, function* () {
      return this.advancedOptions.recoveryShareManagement === "AWS_MANAGED" ? this.awsManagedLogin.verifyPaperEmailLoginOtp(e2) : this.userManagedLogin.verifyPaperEmailLoginOtp(e2);
    });
  }
  logout() {
    return i2(this, null, function* () {
      let { success: e2 } = yield this.AuthQuerier.call({ procedureName: "logout", params: void 0 }), t = yield this.localStorage.removeAuthCookie(), r = yield this.localStorage.removeWalletUserId();
      return { success: e2 || t || r };
    });
  }
};
var R = class {
  constructor({ chain: e2, clientId: t, querier: r }) {
    this.chain = e2, this.clientId = t, this.gaslessTransactionQuerier = r;
  }
  callContract(a) {
    return i2(this, arguments, function* ({ contractAddress: e2, methodArgs: t, methodInterface: r }) {
      return yield this.gaslessTransactionQuerier.call({ procedureName: "callContract", params: { chain: this.chain, contractAddress: e2, method: { args: t, stub: r } } });
    });
  }
};
var T = class extends Signer {
  constructor({ provider: t, clientId: r, querier: a }) {
    var o;
    super();
    this.DEFAULT_ETHEREUM_CHAIN_ID = 5;
    this.clientId = r, this.querier = a, this.endpoint = (o = t.connection) == null ? void 0 : o.url, defineReadOnly(this, "provider", t);
  }
  getAddress() {
    return i2(this, null, function* () {
      let { address: t } = yield this.querier.call({ procedureName: "getAddress", params: void 0 });
      return t;
    });
  }
  signMessage(t) {
    return i2(this, null, function* () {
      var o, n, d, l;
      let r = yield (o = this.provider) == null ? void 0 : o.getNetwork();
      r && r._defaultProvider;
      let { signedMessage: a } = yield this.querier.call({ procedureName: "signMessage", params: { message: t, chainId: (l = (d = yield (n = this.provider) == null ? void 0 : n.getNetwork()) == null ? void 0 : d.chainId) != null ? l : this.DEFAULT_ETHEREUM_CHAIN_ID, rpcEndpoint: this.endpoint } });
      return a;
    });
  }
  signTransaction(t) {
    return i2(this, null, function* () {
      var a, o, n;
      let { signedTransaction: r } = yield this.querier.call({ procedureName: "signTransaction", params: { transaction: t, chainId: (n = (o = yield (a = this.provider) == null ? void 0 : a.getNetwork()) == null ? void 0 : o.chainId) != null ? n : this.DEFAULT_ETHEREUM_CHAIN_ID, rpcEndpoint: this.endpoint } });
      return r;
    });
  }
  _signTypedData(t, r, a) {
    return i2(this, null, function* () {
      var n, d, l;
      let { signedTypedData: o } = yield this.querier.call({ procedureName: "signTypedDataV4", params: { domain: t, types: r, message: a, chainId: (l = (d = yield (n = this.provider) == null ? void 0 : n.getNetwork()) == null ? void 0 : d.chainId) != null ? l : this.DEFAULT_ETHEREUM_CHAIN_ID, rpcEndpoint: this.endpoint } });
      return o;
    });
  }
  connect(t) {
    return new T({ clientId: this.clientId, provider: t, querier: this.querier });
  }
};
var O = class {
  constructor({ clientId: e2, chain: t, querier: r }) {
    this.clientId = e2, this.chain = t, this.walletManagerQuerier = r, this.gasless = new R({ chain: t, clientId: e2, querier: r }), this.localStorage = new h({ clientId: e2 });
  }
  postWalletSetUp(o) {
    return i2(this, arguments, function* ({ deviceShareStored: e2, walletAddress: t, isIframeStorageEnabled: r, walletUserId: a }) {
      return r || (yield this.localStorage.saveDeviceShare(e2, a)), { walletAddress: t };
    });
  }
  getUserWalletStatus() {
    return i2(this, null, function* () {
      let e2 = yield this.walletManagerQuerier.call({ procedureName: "getUserStatus", params: void 0 });
      return e2.status === "Logged In, Wallet Initialized" ? { status: "Logged In, Wallet Initialized", user: y(u({}, e2.user), { wallet: this }) } : e2;
    });
  }
  setChain(t) {
    return i2(this, arguments, function* ({ chain: e2 }) {
      this.chain = e2, this.gasless = new R({ chain: e2, clientId: this.clientId, querier: this.walletManagerQuerier });
    });
  }
  getEthersJsSigner(e2) {
    return i2(this, null, function* () {
      var r;
      return new T({ clientId: this.clientId, provider: getDefaultProvider((r = e2 == null ? void 0 : e2.rpcEndpoint) != null ? r : e[this.chain]), querier: this.walletManagerQuerier });
    });
  }
};
var N = class {
  constructor({ clientId: e2, chain: t, styles: r, advancedOptions: a, onAuthSuccess: o }) {
    this.clientId = e2, this.querier = new _({ clientId: e2, customizationOptions: r }), this.wallet = new O({ clientId: e2, chain: t, querier: this.querier }), this.auth = new M({ clientId: e2, advancedOptions: u({ recoveryShareManagement: "USER_MANAGED" }, a != null ? a : {}), querier: this.querier, onAuthSuccess: (n) => i2(this, null, function* () {
      return yield this.wallet.postWalletSetUp(y(u({}, n.walletDetails), { walletUserId: n.storedToken.authDetails.userWalletId })), yield this.querier.call({ procedureName: "initIframe", params: { deviceShareStored: n.walletDetails.deviceShareStored, clientId: this.clientId, walletUserId: n.storedToken.authDetails.userWalletId, authCookie: n.storedToken.cookieString } }), o == null || o(n), { user: { status: "Logged In, Wallet Initialized", authDetails: n.storedToken.authDetails, wallet: this.wallet, walletAddress: n.walletDetails.walletAddress } };
    }) });
  }
  getUser() {
    return i2(this, null, function* () {
      let e2 = yield this.wallet.getUserWalletStatus();
      switch (e2.status) {
        case "Logged In, New Device":
        case "Logged In, Wallet Uninitialized":
          return yield this.auth.logout(), this.getUser();
        case "Logged Out":
          return { status: "Logged Out" };
        case "Logged In, Wallet Initialized":
          return u({ status: "Logged In, Wallet Initialized" }, e2.user);
      }
    });
  }
};

export {
  J,
  L,
  I,
  W,
  X,
  w,
  Y,
  H,
  P,
  N
};
//# sourceMappingURL=chunk-GBAQ25IJ.js.map
